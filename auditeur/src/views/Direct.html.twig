{% extends 'Template.html.twig' %}
{% set root = base_url() %}

{% block head %}
<!--  block head qui hérite de son parent, template.html.twig. On y ajoute le css désiré -->
{{ parent() }}
<link rel="stylesheet" href="{{ root }}/public/style/css/Direct.css"> 
{% endblock %}

{% block body %}
    {{ parent() }}
    <div class="col-lg-6 mx-auto my-5 col-sm-8 col-10 leDirect py-3">
        
        {# <i class="fa fa-spinner fa-pulse fa-4x ico-btn"></i> #}
        {# <i class="fas fa-pause-circle fa-4x pl-2 ico-btn"></i>
        <i class="fas fa-play-circle fa-4x ico-btn pl-2"></i> #}
        <audio id="audioPlayer" ontimeupdate="update(this)">
            <source src="{{root}}/public/Madcon.mp3" type="audio/ogg" />
            <source src="{{root}}/public/Madcon.mp3" type="audio/mp3" />
            Votre navigateur ne supporte pas la balise AUDIO.
        </audio>

        <a type="button" class="btn-floating deep-orange waves-effect waves-light control" onclick="play('audioPlayer', this, {{creneauMtn}})"><i class="fas fa-play" id="iconeAudio"></i></a>
        <a type="button" class="btn-floating deep-orange waves-effect waves-light control" onclick="resume('audioPlayer')"><i class="fas fa-stop" aria-hidden="true"></i></a>

        {# <button class="control" onclick="play('audioPlayer', this)">Play</button>
        <button class="control" onclick="resume('audioPlayer')">Stop</button> #}
    
        <span class="volume">
            <a class="stick1" id="stick1" onclick="volume('audioPlayer', 0)"></a>
            <a class="stick2" id="stick2" onclick="volume('audioPlayer', 0.3)"></a>
            <a class="stick3" id="stick3" onclick="volume('audioPlayer', 0.5)"></a>
            <a class="stick4" id="stick4" onclick="volume('audioPlayer', 0.7)"></a>
            <a class="stick5" id="stick5" onclick="volume('audioPlayer', 1)"></a>
        </span>

        <div>
            <div id="progressBarControl">
                <div id="progressBar">Pas de lecture</div>
            </div>
        </div> 


    </div>

    <div class="mx-auto pasEmission col-lg-5 col-sm-8 col-8 mt-5 p-2">
        <h3 class="titrePasEmis text-center">Pas d'émission actuellement.</h3> 
        {% if emissionsAvenir is empty %}
            <p class="text-center">Il n'y a pas d'émissions prévues aujourd'hui</p>
        {% else %}
            <p class="text-center">La prochaine émission, <b>{{titreProchaineEmis}}</b> arrive dans : <b>{{tempsAvantEmis}}</b> minute(s) à <b>{{heureProchEmiss}}</b></p>
            <p class="text-center">Les émissions d'aujourd'hui :</p>
            <ul class="text-center">
            {% for emissionsAjd in emissionsAvenir %}
                <li><b>{{ emissionsAjd.titre}}</b></li>
            {% endfor %}
            </ul>            
        {% endif %}
        {% if emissionsPassees is empty %}
            <p class="text-center">Vous n'avez raté aucune émission aujourd'hui</p>
        {% else %}
            <p class="text-center">Les émissions que vous avez ratées aujourd'hui : </p>
            <ul class="text-center">
            {% for emissionsPass in emissionsPassees %}
                <li><b>{{ emissionsPass.titre}}</b></li>
            {% endfor %}
            </ul>
        {% endif %}
    </div>

    <div style="color:white;">
        {% if emissionMtn is null %}
            Pas d'émission actuellement. La prochaine émission arrive dans {{hAvenir}}min 
        {% else %}
            Emission en direct : {{emissionMtn.titre}}
        {% endif %}
        </br>
        Les prochaines émissions d'aujourd'hui : 
        {% for emissionsAjd in emissionsAvenir %}
            {{ emissionsAjd.titre}} // 
        {% endfor %}
        {% if emissionsAvenir is empty %}
            Il n'y a aucune émission programmée
        {% endif %}
        </br>
        {% if emissionsPassees is null %}
            Vous n'avez raté aucune émission
        {% else %}
            Les émissions que vous avez ratées : 
            {% for emissionsPass in emissionsPassees %}
                {{ emissionsPass.titre}} // 
            {% endfor %}
        {% endif %}
        
    </div>
<script>

function play(idPlayer, control, crenMtn) {
    let player = document.querySelector('#' + idPlayer);
    let btnPlPau = document.querySelector('.btn-floating');
    let leDirect = document.querySelector('.leDirect');
    let msgPasEmission = document.querySelector('.pasEmission');
    let icone = document.querySelector('#iconeAudio');
    let datCren = new Date();
    let datActu = new Date();
    let debutCren;

    // Test si on est actuellement dans un créneau
    if (crenMtn)
    {
        // On split l'heure de début pour pouvoir utiliser setHours
        let heureCrenConvert = crenMtn.heure_debut.split(":");
        //On a donc l'heure du début du créneau
        debutCren = datCren.setHours(heureCrenConvert[0], heureCrenConvert[1], heureCrenConvert[2]);

        // Obtention de l'heure actuel en milliseconds
        let actuHour = datActu.getTime();

        // Différence entre l'heure actuelle et le début du créneau converti en seconds
        let diffDirect = (actuHour - debutCren) / 1000;

        // Initialisation d'une première class pour l'icone
        icone.classList.add("fas");

        // Si direct est mis en pause :
        if (player.paused) {
            // Départ du direct au nombre de secondes écoulées depuis le début du créneau
            player.currentTime = diffDirect;
            player.play();

            icone.classList.remove("fa-play");
            icone.classList.add("fa-pause");
            
        } else {
            player.pause();	
            icone.classList.remove("fa-pause");
            icone.classList.add("fa-play");
        }
    }
    else
    {
        // On enlève l'affichage des options du direct afin d'éviter tout problèmes. Ils sont inutiles de toute façon. Et on affiche un message
        leDirect.style.display = "none";
        msgPasEmission.style.display = "block";
        return;
    }
	
}

function resume(idPlayer) {
    let icone = document.querySelector('#iconeAudio');

    let player = document.querySelector('#' + idPlayer);
	
    player.currentTime = 0;
    icone.classList.remove("fa-pause");
    icone.classList.add("fa-play");
    player.pause();
}

function volume(idPlayer, vol) {
    let player = document.querySelector('#' + idPlayer);
    player.volume = vol;	
}

function update(player) {
    let duration = player.duration;    // Durée totale
    let time     = player.currentTime; // Temps écoulé
    let fraction = time / duration;
    let percent  = Math.ceil(fraction * 100);

    let progress = document.querySelector('#progressBar');
	
    progress.style.width = percent + '%';
    progress.textContent = percent + '%';
}


</script>
{% endblock %}
